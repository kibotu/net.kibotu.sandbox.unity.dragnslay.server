#!/usr/bin/env node
var debug = require('debug')('server');
var app = require('../app');
var http = require('http').Server(app);

var io = require('socket.io')(http);

var server_ip_address = process.env.OPENSHIFT_NODEJS_IP || '127.0.0.1';
app.set('tcp_port', process.env.PORT || process.env.OPENSHIFT_NODEJS_PORT || 8080);
app.set('udp_port', 1338);

app.get('/', function(req, res){
    res.sendfile('index.html');
});

io.on('connect', function (socket){
    debug("New connect from " + socket.request.connection.remoteAddress + ":" + socket.request.connection.remotePort);

    socket.emit('message', { message: 'Welcome!', uid: "World!" });
});

io.on('connection', function(socket){
    debug("New connection from " + socket.request.connection.remoteAddress + ":" + socket.request.connection.remotePort);
});

var server = http.listen(function() {
    debug('Express server listening on port ' + server_ip_address + ':' + server.address().port);
});